angular.module('app.control', []).

  // ---------------------------------------------------------------------------
  directive('selector', function($timeout) {
    return {
      scope: {
        placeholder: '='
      },
      controller: function($scope) {

        // Public
        $scope.init = function(index, element) {
          init(element);
          $(element).on('click', select);
        }

        // Private
        var init = function(element) {
          var $element = $(element);
          var value = $element.data('value');
          $element.addClass(value.replace('.',' '));
          if(value == $scope.placeholder) {
            $element.addClass('selected');
          }
        }
        var select = function(evt) {
          $(this).siblings().removeClass('selected');
          $(this).addClass('selected');
          $scope.placeholder = $(this).data('value');
          update();
        }
        var update = function() {
          // NOTE: Angular Bug
          //   Without $timeout, watch function may wait to fire & not trigger immediately causing data-binding update problem
          $timeout(function() { if($scope) { $scope.$apply() }});
        }

      },
      link: function(scope, element, attrs) {
        if(attrs.selected) {
          scope.placeholder = attrs.selected; 
        }
        $(element).children().each(scope.init);
      }
    }
 })
